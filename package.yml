name       : riot
version    : 0.9.7
release    : 1
homepage   : https://riot.im/
source     :
    - https://github.com/vector-im/riot-web/archive/v0.9.7.tar.gz : 0cd4f4b4d2662846bf76ea5eb0642d6cf3dd7e29d791c1cfc409ae6ede23e285
license    : Apache-2.0
component  : network.im
networking : yes
summary    : Electron based Matrix client built using the Matrix React SDK
description: |
    Riot is an electron based Matrix client that allows cross platform
    communication between other IRC, slack, gitter and other riot/matrix
    users.  Also has secure end to end encrypted group(or 1 to 1) chat
    through text, audio and video with other users of riot/matrix on
    Android, iOS, Windows, OSX, Linux and/or web browsers.
builddeps  :
    - pkgconfig(alsa)
    - pkgconfig(atk)
    - pkgconfig(gconf-2.0)
    - pkgconfig(gdk-x11-2.0)
    - pkgconfig(pango)
    - pkgconfig(xcomposite)
    - pkgconfig(xcursor)
    - pkgconfig(xi)
    - pkgconfig(xrandr)
    - pkgconfig(xscrnsaver)
    - git
    - nodejs
rundeps    :
    - nodejs
setup      : |
    %patch -p1 < $pkgfiles/0001-patch-deb-electron-build.patch
    %patch -p1 < $pkgfiles/remove-google-analytics.patch
    npm install
    npm install electron
build      : |
    npm run build
    node_modules/.bin/build -l --x64
install    : |
    install -dm00644 $installdir/usr/bin
    install -dm00644 $installdir/usr/share/riot
    cp -Rv electron/dist/linux-unpacked/* $installdir/usr/share/riot/
    ln -sv ../share/riot/riot-web $installdir/usr/bin/riot-web

    # Install Icons
    for icon_size in 16 24 48 64 96 128 256 512
    do
        install -D -m00644 electron/build/icons/${icon_size}x${icon_size}.png $installdir/usr/share/icons/hicolor/${icon_size}x${icon_size}/apps/riot-web.png
    done

    # Desktop File
    rm -f $installdir/usr/share/applications/riot.desktop
    install -D -m00644 $pkgfiles/riot.desktop $installdir/usr/share/applications/riot.desktop
