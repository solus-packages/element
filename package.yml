name       : riot
version    : 1.6.8
release    : 66
homepage   : https://riot.im/
source     :
    - git|https://github.com/vector-im/riot-desktop.git : v1.6.8
    - git|https://github.com/vector-im/riot-web.git : v1.6.8
license    : Apache-2.0
component  : network.im
networking : yes
summary    : Electron based Matrix client built using the Matrix React SDK
description: |
    Riot is an electron based Matrix client that allows cross platform communication between IRC, slack, gitter and riot/matrix users. Also has secure end to end encrypted chat through text, audio and video with users of riot/matrix on Android, iOS, Windows, OSX, Linux and web browsers.
builddeps  :
    - pkgconfig(alsa)
    - pkgconfig(atk)
    - pkgconfig(gbm)
    - pkgconfig(gconf-2.0)
    - pkgconfig(gdk-3.0)
    - pkgconfig(libsecret-1)
    - pkgconfig(pango)
    - pkgconfig(sqlcipher)
    - pkgconfig(xcomposite)
    - pkgconfig(xcursor)
    - pkgconfig(xtst)
    - pkgconfig(xrandr)
    - pkgconfig(xscrnsaver)
    - cargo
    - git
    - yarn
rundeps    :
    - nodejs
    - libsecret
    - sqlcipher
setup      : |
    # Copy riot-web to the build directory
    cp -a $sources/riot-web.git riot-web

    # Remove update URL from config to disable auto-updates
    sed -i 's|"https://packages.riot.im/desktop/update/"|null|g' riot.im/release/config.json

    # Perform yarn install on both
    yarn install
    yarn --cwd riot-web install
build      : |
    # Build riot-web
    yarn --cwd riot-web build

    # Build riot-desktop
    yarn run build:native
    yarn run build
install    : |
    install -dm00644 $installdir/usr/bin
    install -dm00644 $installdir/usr/share/riot
    cp -Rv dist/linux-unpacked/* $installdir/usr/share/riot/
    cp -Rv riot-web/webapp $installdir/usr/share/riot/resources/
    ln -sv ../share/riot/riot-desktop $installdir/usr/bin/riot-desktop

    # Install default configuration
    install -Dm00644 riot.im/release/config.json $installdir/usr/share/riot/resources/webapp/

    # Install Icons
    for icon_size in 16 24 48 64 96 128 256 512
    do
        install -Dm00644 build/icons/${icon_size}x${icon_size}.png $installdir/usr/share/icons/hicolor/${icon_size}x${icon_size}/apps/riot-desktop.png
    done

    # Desktop File
    install -Dm00644 $pkgfiles/riot.desktop $installdir/usr/share/applications/riot.desktop
